
SELECT 
  COALESCE(rm.consecutivo_de_registro, ra.consecutivo_de_registro) as consecutivo_de_registro,
  rm.codigo_de_habilitacion_ips_primaria as rm_ips,
  ra.codigo_de_habilitacion_ips_primaria as ra_ips
FROM resolucion_manual rm
FULL OUTER JOIN resolucion_automatica ra
  ON rm.consecutivo_de_registro = ra.consecutivo_de_registro
WHERE rm.codigo_de_habilitacion_ips_primaria IS DISTINCT FROM ra.codigo_de_habilitacion_ips_primaria;

INSERT INTO resolucion_manual (
    Tipo_de_registro,
    Consecutivo_de_registro,
    Codigo_de_habilitacion_IPS_primaria,
    Tipo_de_identificacion_del_usuario,
    Numero_de_identificacion_del_usuario,
    Primer_apellido_del_usuario,
    Segundo_apellido_del_usuario,
    Primer_nombre_del_usuario,
    Segundo_nombre_del_usuario,
    Fecha_de_Nacimiento,
    Sexo,
    Codigo_pertenencia_etnica,
    Codigo_de_ocupacion,
    Codigo_de_nivel_educativo,
    Gestante,
    Sifilis_Gestacional_o_congenita,
    Resultado_de_la_prueba_mini_mental_state,
    Hipotiroidismo_Congenito,
    Sintomatico_respiratorio,
    Consumo_de_tabaco,
    Lepra,
    Obesidad_o_Desnutricion_Proteico_Calorica,
    Resultado_del_tacto_rectal,
    Acido_folico_preconcepcional,
    Resultado_de_la_prueba_sangre_oculta_en_materia_fecal,
    Enfermedad_Mental,
    Cancer_de_Cervix,
    Agudeza_visual_lejana_ojo_izquierdo,
    Agudeza_visual_lejana_ojo_derecho,
    Fecha_del_peso,
    Peso_en_Kilogramos,
    Fecha_de_la_talla,
    Talla_en_centimetros,
    Fecha_probable_de_parto,
    Codigo_pais,
    Clasificacion_del_riesgo_gestacional,
    Resultado_de_colonoscopia_tamizaje,
    Resultado_de_tamizaje_auditivo_neonatal,
    Resultado_de_tamizaje_visual_neonatal,
    DPT_menores_de_5_anos,
    Resultado_de_tamizaje_VALE,
    Neumococo,
    Resultado_de_tamizaje_para_hepatitis_C,
    Resultado_de_escala_desarrollo_area_de_motricidad_gruesa,
    Resultado_de_escala_desarrollo_area_de_motricidad_finoadaptativa,
    Resultado_de_escala_desarrollo_area_personal_social,
    Resultado_de_escala_desarrollo_area_de_motricidad_audicion_lenguaje,
    Tratamiento_ablativo_o_de_escision_posterior_a_la_realizacion_de_la_tecnica_de_inspeccion_visual,
    Resultado_de_tamizaje_con_oximetria_pre_y_post_ductal,
    Fecha_de_atencion_parto_o_cesarea,
    Fecha_de_salida_de_atencion_parto_o_cesarea,
    Fecha_de_atencion_en_salud_para_la_promocion_y_apoyo_de_la_lactancia_materna,
    Fecha_de_consulta_de_valoracion_integral,
    Fecha_de_atencion_en_salud_para_la_asesoria_en_anticoncepcion,
    Suministro_de_metodo_anticonceptivo,
    Fecha_de_suministro_de_metodo_anticonceptivo,
    Fecha_de_primera_consulta_prenatal,
    Resultado_de_glicemia_basal,
    Fecha_de_ultimo_control_prenatal_de_seguimiento,
    Suministro_de_acido_folico_en_el_control_prenatal,
    Suministro_de_sulfato_ferroso_en_el_control_prenatal,
    Suministro_de_carbonato_de_calcio_en_el_control_prenatal,
    Fecha_de_valoracion_agudeza_visual,
    Fecha_de_tamizaje_VALE,
    Fecha_del_tacto_rectal,
    Fecha_de_tamizaje_con_oximetria_pre_y_post_ductal,
    Fecha_de_realizacion_colonoscopia_tamizaje,
    Fecha_de_la_prueba_sangre_oculta_en_materia_fecal,
    Consulta_de_Psicologia,
    Fecha_de_tamizaje_auditivo_neonatal,
    Suministro_de_fortificacion_casera_en_la_primera_infancia,
    Suministro_de_vitamina_A_en_la_primera_infancia,
    Fecha_de_toma_LDL,
    Fecha_de_toma_PSA,
    Preservativos_entregados_a_pacientes_con_ITS,
    Fecha_de_tamizaje_visual_neonatal,
    Fecha_de_atencion_en_salud_bucal_por_profesional_en_odontologia,
    Suministro_de_hierro_en_la_primera_Infancia,
    Fecha_de_antigeno_de_superficie_hepatitis_B,
    Resultado_de_antigeno_de_superficie_hepatitis_B,
    Fecha_de_toma_de_prueba_tamizaje_para_sifilis,
    Resultado_de_prueba_tamizaje_para_sifilis,
    Fecha_de_toma_de_prueba_para_VIH,
    Resultado_de_prueba_para_VIH,
    Fecha_de_TSH_neonatal,
    Resultado_de_TSH_neonatal,
    Tamizaje_del_cancer_de_cuello_uterino,
    Fecha_de_tamizaje_cancer_de_cuello_uterino,
    Resultado_tamizaje_cancer_de_cuello_uterino,
    Calidad_en_la_muestra_de_citologia_cervicouterina,
    Codigo_de_habilitacion_IPS_donde_se_realiza_tamizaje_cancer_de_cuello_uterino,
    Fecha_de_colposcopia,
    Resultado_de_LDL,
    Fecha_de_biopsia_cervicouterina,
    Resultado_de_biopsia_cervicouterina,
    Resultado_de_HDL,
    Fecha_de_toma_de_mamografia,
    Resultado_de_mamografia,
    Resultado_de_trigliceridos,
    Fecha_de_toma_biopsia_de_mama,
    Fecha_de_resultado_biopsia_de_mama,
    Resultado_de_biopsia_de_mama,
    COP_por_persona,
    Fecha_de_toma_hemoglobina,
    Resultado_de_hemoglobina,
    Fecha_de_toma_glicemia_basal,
    Fecha_de_toma_creatinina,
    Resultado_de_creatinina,
    Preservativos_entregados_a_pacientes_con_ITS_2,
    Resultado_de_PSA,
    Fecha_de_toma_de_tamizaje_hepatitis_C,
    Fecha_de_toma_HDL,
    Fecha_de_toma_de_baciloscopia_diagnostico,
    Resultado_de_baciloscopia_diagnostico,
    Clasificacion_del_riesgo_cardiovascular,
    Tratamiento_para_sifilis_gestacional,
    Tratamiento_para_Sifilis_Congenita,
    Clasificacion_del_riesgo_metabolico,
    Fecha_de_toma_trigliceridos
)
SELECT
    ra.Tipo_de_registro,
    ra.Consecutivo_de_registro,
    ra.Codigo_de_habilitacion_IPS_primaria,
    ra.Tipo_de_identificacion_del_usuario,
    ra.Numero_de_identificacion_del_usuario,
    ra.Primer_apellido_del_usuario,
    ra.Segundo_apellido_del_usuario,
    ra.Primer_nombre_del_usuario,
    ra.Segundo_nombre_del_usuario,
    ra.Fecha_de_Nacimiento,
    ra.Sexo,
    ra.Codigo_pertenencia_etnica,
    ra.Codigo_de_ocupacion,
    ra.Codigo_de_nivel_educativo,
    ra.Gestante,
    ra.Sifilis_Gestacional_o_congenita,
    ra.Resultado_de_la_prueba_mini_mental_state,
    ra.Hipotiroidismo_Congenito,
    ra.Sintomatico_respiratorio,
    ra.Consumo_de_tabaco,
    ra.Lepra,
    ra.Obesidad_o_Desnutricion_Proteico_Calorica,
    ra.Resultado_del_tacto_rectal,
    ra.Acido_folico_preconcepcional,
    ra.Resultado_de_la_prueba_sangre_oculta_en_materia_fecal,
    ra.Enfermedad_Mental,
    ra.Cancer_de_Cervix,
    ra.Agudeza_visual_lejana_ojo_izquierdo,
    ra.Agudeza_visual_lejana_ojo_derecho,
    ra.Fecha_del_peso,
    ra.Peso_en_Kilogramos,
    ra.Fecha_de_la_talla,
    ra.Talla_en_centimetros,
    ra.Fecha_probable_de_parto,
    ra.Codigo_pais,
    ra.Clasificacion_del_riesgo_gestacional,
    ra.Resultado_de_colonoscopia_tamizaje,
    ra.Resultado_de_tamizaje_auditivo_neonatal,
    ra.Resultado_de_tamizaje_visual_neonatal,
    ra.DPT_menores_de_5_anos,
    ra.Resultado_de_tamizaje_VALE,
    ra.Neumococo,
    ra.Resultado_de_tamizaje_para_hepatitis_C,
    ra.Resultado_de_escala_desarrollo_area_de_motricidad_gruesa,
    ra.Resultado_de_escala_desarrollo_area_de_motricidad_finoadaptativa,
    ra.Resultado_de_escala_desarrollo_area_personal_social,
    ra.Resultado_de_escala_desarrollo_area_de_motricidad_audicion_lenguaje,
    ra.Tratamiento_ablativo_o_de_escision_posterior_a_la_realizacion_de_la_tecnica_de_inspeccion_visual,
    ra.Resultado_de_tamizaje_con_oximetria_pre_y_post_ductal,
    ra.Fecha_de_atencion_parto_o_cesarea,
    ra.Fecha_de_salida_de_atencion_parto_o_cesarea,
    ra.Fecha_de_atencion_en_salud_para_la_promocion_y_apoyo_de_la_lactancia_materna,
    ra.Fecha_de_consulta_de_valoracion_integral,
    ra.Fecha_de_atencion_en_salud_para_la_asesoria_en_anticoncepcion,
    ra.Suministro_de_metodo_anticonceptivo,
    ra.Fecha_de_suministro_de_metodo_anticonceptivo,
    ra.Fecha_de_primera_consulta_prenatal,
    ra.Resultado_de_glicemia_basal,
    ra.Fecha_de_ultimo_control_prenatal_de_seguimiento,
    ra.Suministro_de_acido_folico_en_el_control_prenatal,
    ra.Suministro_de_sulfato_ferroso_en_el_control_prenatal,
    ra.Suministro_de_carbonato_de_calcio_en_el_control_prenatal,
    ra.Fecha_de_valoracion_agudeza_visual,
    ra.Fecha_de_tamizaje_VALE,
    ra.Fecha_del_tacto_rectal,
    ra.Fecha_de_tamizaje_con_oximetria_pre_y_post_ductal,
    ra.Fecha_de_realizacion_colonoscopia_tamizaje,
    ra.Fecha_de_la_prueba_sangre_oculta_en_materia_fecal,
    ra.Consulta_de_Psicologia,
    ra.Fecha_de_tamizaje_auditivo_neonatal,
    ra.Suministro_de_fortificacion_casera_en_la_primera_infancia,
    ra.Suministro_de_vitamina_A_en_la_primera_infancia,
    ra.Fecha_de_toma_LDL,
    ra.Fecha_de_toma_PSA,
    ra.Preservativos_entregados_a_pacientes_con_ITS,
    ra.Fecha_de_tamizaje_visual_neonatal,
    ra.Fecha_de_atencion_en_salud_bucal_por_profesional_en_odontologia,
    ra.Suministro_de_hierro_en_la_primera_Infancia,
    ra.Fecha_de_antigeno_de_superficie_hepatitis_B,
    ra.Resultado_de_antigeno_de_superficie_hepatitis_B,
    ra.Fecha_de_toma_de_prueba_tamizaje_para_sifilis,
    ra.Resultado_de_prueba_tamizaje_para_sifilis,
    ra.Fecha_de_toma_de_prueba_para_VIH,
    ra.Resultado_de_prueba_para_VIH,
    ra.Fecha_de_TSH_neonatal,
    ra.Resultado_de_TSH_neonatal,
    ra.Tamizaje_del_cancer_de_cuello_uterino,
    ra.Fecha_de_tamizaje_cancer_de_cuello_uterino,
    ra.Resultado_tamizaje_cancer_de_cuello_uterino,
    ra.Calidad_en_la_muestra_de_citologia_cervicouterina,
    ra.Codigo_de_habilitacion_IPS_donde_se_realiza_tamizaje_cancer_de_cuello_uterino,
    ra.Fecha_de_colposcopia,
    ra.Resultado_de_LDL,
    ra.Fecha_de_biopsia_cervicouterina,
    ra.Resultado_de_biopsia_cervicouterina,
    ra.Resultado_de_HDL,
    ra.Fecha_de_toma_de_mamografia,
    ra.Resultado_de_mamografia,
    ra.Resultado_de_trigliceridos,
    ra.Fecha_de_toma_biopsia_de_mama,
    ra.Fecha_de_resultado_biopsia_de_mama,
    ra.Resultado_de_biopsia_de_mama,
    ra.COP_por_persona,
    ra.Fecha_de_toma_hemoglobina,
    ra.Resultado_de_hemoglobina,
    ra.Fecha_de_toma_glicemia_basal,
    ra.Fecha_de_toma_creatinina,
    ra.Resultado_de_creatinina,
    ra.Preservativos_entregados_a_pacientes_con_ITS_2,
    ra.Resultado_de_PSA,
    ra.Fecha_de_toma_de_tamizaje_hepatitis_C,
    ra.Fecha_de_toma_HDL,
    ra.Fecha_de_toma_de_baciloscopia_diagnostico,
    ra.Resultado_de_baciloscopia_diagnostico,
    ra.Clasificacion_del_riesgo_cardiovascular,
    ra.Tratamiento_para_sifilis_gestacional,
    ra.Tratamiento_para_Sifilis_Congenita,
    ra.Clasificacion_del_riesgo_metabolico,
    ra.Fecha_de_toma_trigliceridos
FROM resolucion_automatica ra
         LEFT JOIN resolucion_manual rm
                   ON ra.numero_de_identificacion_del_usuario = rm.numero_de_identificacion_del_usuario
WHERE rm.numero_de_identificacion_del_usuario IS NULL
RETURNING *;



SELECT
    Numero_de_identificacion_del_usuario,
    COUNT(*) AS Repeticiones
FROM
    resolucion_automatica
GROUP BY
    Numero_de_identificacion_del_usuario
HAVING
    COUNT(*) > 1;
